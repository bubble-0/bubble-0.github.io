(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{445:function(r,s,t){"use strict";t.r(s);var a=t(17),v=Object(a.a)({},(function(){var r=this,s=r.$createElement,t=r._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[t("h2",{attrs:{id:"操作系统环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作系统环境准备"}},[r._v("#")]),r._v(" 操作系统环境准备")]),r._v(" "),t("h3",{attrs:{id:"设置主机名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置主机名"}},[r._v("#")]),r._v(" 设置主机名")]),r._v(" "),t("ul",[t("li",[r._v("vi /etc/sysconfig/network")]),r._v(" "),t("li",[r._v("hostnamectl set-hostname XXX"),t("br"),r._v("\n修改对应的配置"),t("br"),r._v("\n主节点 hmaster"),t("br"),r._v("\n子节点 hslave1"),t("br"),r._v("\n...")])]),r._v(" "),t("h3",{attrs:{id:"设置主机ip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置主机ip"}},[r._v("#")]),r._v(" 设置主机ip")]),r._v(" "),t("ul",[t("li",[r._v("vi /etc/sysconfig/network-scripts/ifcfg-ens33"),t("br"),r._v("\nBOOTPROTO=static   网络桥接改为static"),t("br"),r._v("\nIPADDR=192.168.111.101   设置IP"),t("br"),r._v("\nNETMASK=255.255.255.0   子网掩码"),t("br"),r._v("\nGATEWAY=192.168.1.1   默认网关"),t("br"),r._v("\nDNS1=192.168.111.1   首选DNS服务器"),t("br"),r._v("\nONBOOT=yes   开机自启动")]),r._v(" "),t("li",[r._v("systemctl restart network"),t("br"),r._v("\n重启生效")])]),r._v(" "),t("h3",{attrs:{id:"设置hosts映射"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置hosts映射"}},[r._v("#")]),r._v(" 设置hosts映射")]),r._v(" "),t("ul",[t("li",[r._v("vi /etc/hosts"),t("br"),r._v("\n192.168.111.101 hmaster"),t("br"),r._v("\n192.168.111.102 hslave1")])]),r._v(" "),t("h3",{attrs:{id:"永久关闭防火墙"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#永久关闭防火墙"}},[r._v("#")]),r._v(" 永久关闭防火墙")]),r._v(" "),t("ul",[t("li",[r._v("systemctl disable firewalld")])]),r._v(" "),t("h3",{attrs:{id:"关闭selinux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭selinux"}},[r._v("#")]),r._v(" 关闭selinux")]),r._v(" "),t("ul",[t("li",[r._v("vi /etc/selinux/config"),t("br"),r._v("\n修改selinux 为disabled\n重启系统 reboot")])]),r._v(" "),t("h2",{attrs:{id:"安装文件准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装文件准备"}},[r._v("#")]),r._v(" 安装文件准备")]),r._v(" "),t("h3",{attrs:{id:"cm5-12"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cm5-12"}},[r._v("#")]),r._v(" CM5.12")]),r._v(" "),t("ul",[t("li",[r._v("http://archive.cloudera.com/cm5/cm/5")])]),r._v(" "),t("h3",{attrs:{id:"cdh5-12"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cdh5-12"}},[r._v("#")]),r._v(" CDH5.12")]),r._v(" "),t("ul",[t("li",[r._v("http://archive.cloudera.com/cdh5/parcels/5.7.0/")])]),r._v(" "),t("h3",{attrs:{id:"spark2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spark2"}},[r._v("#")]),r._v(" spark2")]),r._v(" "),t("ul",[t("li",[r._v("http://archive.cloudera.com/spark2/parcels/2.1.0.cloudera1/")])]),r._v(" "),t("h3",{attrs:{id:"其他"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[r._v("#")]),r._v(" 其他")]),r._v(" "),t("ul",[t("li",[r._v("https://pkgs.org/")])]),r._v(" "),t("h2",{attrs:{id:"程序依赖包安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#程序依赖包安装"}},[r._v("#")]),r._v(" 程序依赖包安装")]),r._v(" "),t("h3",{attrs:{id:"安装运行环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装运行环境"}},[r._v("#")]),r._v(" 安装运行环境")]),r._v(" "),t("ul",[t("li",[r._v("rpm -ivh openssh-clients-7.4p1-16.el7.x86_64.rpm")]),r._v(" "),t("li",[r._v("rpm -ivh autogen-libopts-5.18-5.el7.x86_64.rpm")]),r._v(" "),t("li",[r._v("rpm -ivh ntp-4.2.6p5-28.el7.centos.x86_64.rpm")]),r._v(" "),t("li",[r._v("rpm -ivh ntpdate-4.2.6p5-28.el7.centos.x86_64.rpm")]),r._v(" "),t("li",[r._v("rpm -ivh perl*")]),r._v(" "),t("li",[r._v("rpm -ivh net-tools-2.0-0.24.20131004git.el7.x86_64.rpm")]),r._v(" "),t("li",[r._v("rpm -ivh libtirpc-0.2.4-0.15.el7.x86_64.rpm")]),r._v(" "),t("li",[r._v("rpm -ivh rpcbind-0.2.0-47.el7.x86_64.rpm")]),r._v(" "),t("li",[r._v("rpm -ivh psmisc-22.20-15.el7.x86_64.rpm")])]),r._v(" "),t("h3",{attrs:{id:"配置ssh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置ssh"}},[r._v("#")]),r._v(" 配置SSH")]),r._v(" "),t("ul",[t("li",[r._v("ssh-keygen -t rsa"),t("br"),r._v("\n一路回车"),t("br"),r._v("\nls /root/.ssh  可以看到刚才生成的文件")]),r._v(" "),t("li",[r._v("ssh-copy-id -i ~/.ssh/id_rsa.pub 主机名"),t("br"),r._v("\n复制刚才生成的文件"),t("br"),r._v("\nssh 主机名就可以不需要密码登录了，主节点子节点都要配置，记得还要给自己复制一次")])]),r._v(" "),t("h3",{attrs:{id:"ntp时间同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ntp时间同步"}},[r._v("#")]),r._v(" NTP时间同步")]),r._v(" "),t("ul",[t("li",[r._v("cat /etc/passwd"),t("br"),r._v("\n检查NTP用户是否存在如果不存在手动创建NTP用户"),t("br"),r._v("\ngroupadd ntp"),t("br"),r._v("\nuseradd -g ntp ntp")]),r._v(" "),t("li",[r._v("vi /etc/ntp.conf"),t("br"),r._v("\n注释掉所有restrict和server")]),r._v(" "),t("li",[t("strong",[r._v("主节点增加如下两行")]),t("br"),r._v("\nserver 127.127.1.0"),t("br"),r._v("\nfudge 127.127.1.0 stratum 10"),t("br"),r._v(" "),t("strong",[r._v("保存之后重启")]),t("br"),r._v("\nsystemctl  restart ntpd")]),r._v(" "),t("li",[r._v("子节点增加"),t("br"),r._v("\nserver XXX (主节点主机名)"),t("br"),r._v("\n关闭NTP服务"),t("br"),r._v("\nsystemctl  stop  ntpd"),t("br"),r._v("\n手动同步时间"),t("br"),r._v("\nntpdate hmaster")]),r._v(" "),t("li",[r._v("systemctl  start  ntpd"),t("br"),r._v("\n所有节点打开NTP服务")]),r._v(" "),t("li",[r._v("chkconfig ntpd on"),t("br"),r._v("\n所有节点设置NTP服务自启动")]),r._v(" "),t("li",[r._v("ntpstat\n子节点运行检查,直到子节点显示同步(大约五分钟)")])]),r._v(" "),t("h3",{attrs:{id:"安装jdk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装jdk"}},[r._v("#")]),r._v(" 安装JDK")]),r._v(" "),t("ul",[t("li",[r._v("查找系统自带的安装包"),t("br"),r._v("\nrpm -qa | grep openjdk"),t("br"),r._v("\nrpm -qa | grep java")]),r._v(" "),t("li",[r._v("rpm -e --nodeps 上面查找到的包名")]),r._v(" "),t("li",[r._v("删除可能存在的注册表信息"),t("br"),r._v("\nalternatives --display libjavaplugin.so.x86_64"),t("br"),r._v("\nalternatives --remove libjavaplugin.so.x86_64 /usr/lib64/IcedTeaPlugin.so")]),r._v(" "),t("li",[r._v("tar -xzvf jdk-8u201-linux-x64.tar.gz"),t("br"),r._v("\n解压文件")]),r._v(" "),t("li",[r._v("mv jdk1.8.0_201/ ../jdk8"),t("br"),r._v("\n重命名并移动")]),r._v(" "),t("li",[r._v("设置环境变量"),t("br"),r._v("\nvi /etc/profile"),t("br"),r._v("\n添加以下信息")])]),r._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[r._v("  export JAVA_HOME=/opt/jdk8  \n  export PATH=$JAVA_HOME/bin:$PATH  \n")])]),r._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[r._v("1")]),t("br"),t("span",{staticClass:"line-number"},[r._v("2")]),t("br")])]),t("p",[r._v(":wq 保存退出")]),r._v(" "),t("ul",[t("li",[r._v("执行生效"),t("br"),r._v("\nsource /etc/profile")]),r._v(" "),t("li",[r._v("验证"),t("br"),r._v("\njava -version")])]),r._v(" "),t("h3",{attrs:{id:"mysql安装-仅主节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql安装-仅主节点"}},[r._v("#")]),r._v(" MYSQL安装(仅主节点)")]),r._v(" "),t("ul",[t("li",[r._v("rpm -ivh numactl-2.0.9-7.el7.x86_64.rpm")]),r._v(" "),t("li",[r._v("groupadd mysql")]),r._v(" "),t("li",[r._v("useradd -g mysql mysql")]),r._v(" "),t("li",[r._v("删除系统自带的mysql、mysql-libs、 mariadb-libs"),t("br"),r._v("\nrpm -qa | grep mysql"),t("br"),r._v("\nrpm -qa | grep mysql-libs"),t("br"),r._v("\nrpm -qa | grep mariadb-libs"),t("br"),r._v("\nrpm -e --nodeps 上面查找到的包名")]),r._v(" "),t("li",[r._v("rpm -ivh   mysql-community-common-5.7.28-1.el7.x86_64.rpm  mysql-community-libs-5.7.28-1.el7.x86_64.rpm mysql-community-client-5.7.28-1.el7.x86_64.rpm   mysql-community-server-5.7.28-1.el7.x86_64.rpm"),t("br"),r._v("\n==**"),t("em",[r._v("如果上面mysql是用rpm一个个安装的话，会有问题\n如果启动报错，可能要修改目录权限=="),t("br"),r._v("\nchown -R mysql:mysql /var/lib/mysql/")])]),r._v(" "),t("li",[r._v("手工初始化"),t("br"),r._v("\nmysqld --initialize --user=mysql")]),r._v(" "),t("li",[r._v("cat /var/log/mysqld.log"),t("br"),r._v("\n查看刚才初始化的密码")]),r._v(" "),t("li",[r._v("systemctl start mysqld"),t("br"),r._v("\n启动mysql")]),r._v(" "),t("li",[t("strong",[r._v("修改初始化的密码")]),t("br"),r._v(" "),t("strong",[r._v("1.使用刚才初始化的密码登录")]),t("br"),r._v("\nmysql -u root -p"),t("br"),r._v("\n输入之前的密码登录之后"),t("br"),r._v("\nuse mysql;"),t("br"),r._v('\nupdate user set authentication_string=password("你的新密码") where user="root";'),t("br"),r._v("\n=="),t("strong",[r._v("mysql新版本的用户表的密码字段为authentication_string之前是password")]),r._v("=="),t("br"),r._v("\nflush privileges;"),t("br"),r._v("\n刷新权限"),t("br"),r._v("\nexit;"),t("br"),r._v(" "),t("strong",[r._v("2.这一步如果之前安装了mysql卸载从新安装或者初始化失败的情况下执行mysqld --initialize --user=mysql 可能会报错，需要从新初始化")]),t("br"),r._v("\n1.查看mysql配置文件,删除配置目录"),t("br"),r._v("\nvi /etc/my.cnf"),t("br"),r._v("\n2.删除datadir的目录后,重新执行"),t("br"),r._v("\nmysqld --initialize --user=mysql"),t("br"),r._v("\n3.重启mysql"),t("br"),r._v("\nsystemctl  restart  mysqld"),t("br"),r._v("\n4.输入密码登录，可能会出现密码不正确的情况，此时需要跳过mysql验证"),t("br"),r._v("\nvi /etc/my.cnf"),t("br"),r._v("\n5.在[mysqld]加入"),t("br"),r._v("\nskip-grant-tables"),t("br"),r._v("\n6.重新启动mysql"),t("br"),r._v("\nsystemctl  restart  mysqld"),t("br"),r._v("\n7.登录之后按照上方步骤修改root用户密码")]),r._v(" "),t("li",[r._v("修改mysql配置文件"),t("br"),r._v("\nvi /etc/my.cnf")]),r._v(" "),t("li",[r._v("在[mysqld]中增加:"),t("br"),r._v("\nskip-name-resolve"),t("br"),r._v("\nport=3306"),t("br"),r._v("\ndefault-storage-engine=InnoDB"),t("br"),r._v("\nlower_case_table_names=1"),t("br"),r._v("\nmax-connections=3000"),t("br"),r._v("\ncharacter_set_server=utf8")]),r._v(" "),t("li",[r._v("在[mysql]中增加([mysql] 不存在的话手工添加,一定要添加到最下方！)"),t("br"),r._v("\ndefault-character-set=utf8")]),r._v(" "),t("li",[r._v("重启数据库"),t("br"),r._v("\nsystemctl  restart  mysqld")]),r._v(" "),t("li",[r._v("mysql自启\nsystemctl  enable  mysqld")]),r._v(" "),t("li",[r._v("允许远程登录，并创建CM、hive数据库"),t("br"),r._v("\nmysql -u root -p")]),r._v(" "),t("li",[r._v("GRANT ALL PRIVILEGES ON "),t("em",[r._v(".")]),r._v(" TO 'root'@'%' IDENTIFIED BY '1234qwer' WITH GRANT OPTION;"),t("br"),r._v("\n允许远程连接"),t("br"),r._v("\n=="),t("strong",[r._v("如果提示需要重新设置密码的话:"),t("br"),r._v("\nSET PASSWORD = PASSWORD('1234qwer');"),t("br"),r._v("\n或者"),t("br"),r._v("\nALTER USER 'root'@'localhost' IDENTIFIED BY '1234qwer' PASSWORD EXPIRE NEVER;"),t("br"),r._v("\n然后"),t("br"),r._v("\nflush privileges;"),t("br"),r._v("\n重新登陆")]),r._v("==")]),r._v(" "),t("li",[r._v("FLUSH PRIVILEGES;")]),r._v(" "),t("li",[r._v("create database cm;")]),r._v(" "),t("li",[r._v("create database hive;")]),r._v(" "),t("li",[r._v("exit;")])]),r._v(" "),t("h4",{attrs:{id:"截止到mysql安装完毕之后请打虚拟机快照保存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#截止到mysql安装完毕之后请打虚拟机快照保存"}},[r._v("#")]),r._v(" 截止到mysql安装完毕之后请打虚拟机快照保存")]),r._v(" "),t("h3",{attrs:{id:"安装cm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装cm"}},[r._v("#")]),r._v(" 安装CM")]),r._v(" "),t("h4",{attrs:{id:"解压安装包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解压安装包"}},[r._v("#")]),r._v(" 解压安装包")]),r._v(" "),t("ul",[t("li",[r._v("tar -zxvf cloudera-manager-centos7-cm5.15.2_x86_64.tar.gz -C  ../")])]),r._v(" "),t("h4",{attrs:{id:"创建cm用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建cm用户"}},[r._v("#")]),r._v(" 创建cm用户")]),r._v(" "),t("ul",[t("li",[r._v('useradd --system --home=/opt/cm-5.15.2/run/cloudera-scm-server/ --no-create-home --shell=/bin/false --comment "Cloudera SCM User" cloudera-scm')])]),r._v(" "),t("h4",{attrs:{id:"复制mysql驱动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复制mysql驱动"}},[r._v("#")]),r._v(" 复制mysql驱动")]),r._v(" "),t("ul",[t("li",[r._v("mkdir -p /usr/share/java")]),r._v(" "),t("li",[r._v("cp mysql-connector-java.jar /usr/share/java")])]),r._v(" "),t("h4",{attrs:{id:"主节点初始化mysql数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主节点初始化mysql数据库"}},[r._v("#")]),r._v(" 主节点初始化mysql数据库")]),r._v(" "),t("ul",[t("li",[r._v("/opt/cm-5.15.2/share/cmf/schema/scm_prepare_database.sh mysql cm -h localhost root 1234qwer --scm-host localhost cm cm cm")])]),r._v(" "),t("h4",{attrs:{id:"修改agent的配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改agent的配置"}},[r._v("#")]),r._v(" 修改agent的配置")]),r._v(" "),t("ul",[t("li",[r._v("vi /opt/cm-5.15.2/etc/cloudera-scm-agent/config.ini"),t("br"),r._v("\n将第三行server_host的值修改为主节点的主机名")])]),r._v(" "),t("h4",{attrs:{id:"准备cdh文件，放到-opt-cloudera-parcel-repo-目录下面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备cdh文件，放到-opt-cloudera-parcel-repo-目录下面"}},[r._v("#")]),r._v(" 准备CDH文件，放到/opt/cloudera/parcel-repo/目录下面")]),r._v(" "),t("ul",[t("li",[r._v("cp -r /opt/installcentos7/CDH/*  /opt/cloudera/parcel-repo")])]),r._v(" "),t("h4",{attrs:{id:"修改验证文件名称"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改验证文件名称"}},[r._v("#")]),r._v(" 修改验证文件名称")]),r._v(" "),t("ul",[t("li",[r._v("cd /opt/cloudera/parcel-repo/")]),r._v(" "),t("li",[r._v("mv CDH-5.15.2-1.cdh5.15.2.p0.3-el7.parcel.sha1   CDH-5.15.2-1.cdh5.15.2.p0.3-el7.parcel.sha")])]),r._v(" "),t("h4",{attrs:{id:"创建agent目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建agent目录"}},[r._v("#")]),r._v(" 创建agent目录")]),r._v(" "),t("ul",[t("li",[r._v("mkdir -p /opt/cm-5.15.2/run/cloudera-scm-agent")])]),r._v(" "),t("h4",{attrs:{id:"启动cm，主节点启动server、agent，子节点只要agent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动cm，主节点启动server、agent，子节点只要agent"}},[r._v("#")]),r._v(" 启动cm，主节点启动server、agent，子节点只要agent")]),r._v(" "),t("ul",[t("li",[r._v("/opt/cm-5.15.2/etc/init.d/cloudera-scm-server start")]),r._v(" "),t("li",[r._v("/opt/cm-5.15.2/etc/init.d/cloudera-scm-agent start")])]),r._v(" "),t("h4",{attrs:{id:"打开浏览器访问-192-168-111-102-7180-进入管理页面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打开浏览器访问-192-168-111-102-7180-进入管理页面"}},[r._v("#")]),r._v(" 打开浏览器访问 192.168.111.102:7180 进入管理页面")]),r._v(" "),t("p",[r._v("按照提示一直下一步")])])}),[],!1,null,null,null);s.default=v.exports}}]);